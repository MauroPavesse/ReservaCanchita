@page
@model ReservaCanchita.Pages.Administrador.MenuModel
@{
	ViewData["Title"] = "Menu";
}

<div>
	<button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#agregarComidaModal">Agregar comida</button>
	<button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#agregarCategoriaModal">Agregar categoria</button>
</div>

<h2>Comidas cargadas</h2>

<div style="overflow-x: auto; width: 100%;">
	<table class="table" style="min-width: 800px;">
		<thead>
			<tr>
				<th>Nombre</th>
				<th>Descripcion</th>
				<th>Categoria</th>
				<th>Precio</th>
				<th>Acciones</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var comida in Model.Comidas)
			{
				<tr>
					<td>@comida.Nombre</td>
					<td>@comida.Descripcion</td>
					<td>@comida.ComidaCategoria?.Nombre</td>
					<td>@comida.Importe.ToString("C")</td>
					<td>
						<button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#editarComidaModal" data-id="@comida.Id" title="Editar">
							<i class="bi bi-pencil"></i>
						</button>
						<button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#eliminarComidaModal" data-id="@comida.Id" title="Eliminar">
							<i class="bi bi-trash"></i>
						</button>
					</td>
				</tr>
			}
		</tbody>
	</table>
</div>


<div class="modal fade" id="agregarComidaModal" tabindex="-1" aria-labelledby="agregarComidaModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="agregarComidaModalLabel">Agregar Comida</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form method="post">
					<div class="mb-3">
						<label for="nombreComida" class="form-label">Comida</label>
						<input type="text" class="form-control" id="nombreComida" name="Nombre" required/>
					</div>
					<div class="mb-3">
						<label for="descripcionComida" class="form-label">Descripcion</label>
						<input type="text" class="form-control" id="descripcionComida" name="Descripcion" required />
					</div>
					<div class="mb-3">
						<label for="importeComida" class="form-label">Precio</label>
						<input type="number" class="form-control" id="importeComida" name="Precio" required />
					</div>
					<div class="mb-3">
						<label for="categoriaComida" class="form-label">Categoría</label>
						<select class="form-control" id="categoriaComida" name="CategoriaId">
							<option value="0" selected>SIN ASIGNAR</option>
							@foreach (var categoria in Model.ComidasCategorias)
							{
								<option value="@categoria.Id">@categoria.Nombre</option>
							}
						</select>
					</div>
					<button type="submit" class="btn btn-primary">Guardar</button>
				</form>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="agregarCategoriaModal" tabindex="-1" aria-labelledby="agregarCategoriaModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="agregarCategoriaModalLabel">Agregar Categoria</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form method="post" asp-page-handler="AgregarCategoria">
					<div class="mb-3">
						<label for="nombreCategoria" class="form-label">Nombre</label>
						<input type="text" class="form-control" id="nombreCategoria" name="Nombre" required/>
					</div>
					<button type="submit" class="btn btn-primary">Guardar</button>
				</form>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="editarComidaModal" tabindex="-1" aria-labelledby="editarComidaModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="editarComidaModalLabel">Editar Comida</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form method="post" asp-page-handler="ActualizarComida" id="formEditarComida">
					<input type="hidden" id="editarComidaId" name="Id" />

					<div class="mb-3">
						<label for="nombreComida" class="form-label">Nombre</label>
						<input type="text" class="form-control" id="editarNombreComida" name="Nombre" required>
					</div>
					<div class="mb-3">
						<label for="descripcionComida" class="form-label">Descripción</label>
						<input type="text" class="form-control" id="editarDescripcionComida" name="Descripcion">
					</div>
					<div class="mb-3">
						<label for="precioComida" class="form-label">Precio</label>
						<input type="number" class="form-control" id="editarPrecioComida" name="Precio" required>
					</div>
					<div class="mb-3">
						<label for="categoriaComida" class="form-label">Categoría</label>
						<select class="form-control" id="editarCategoriaComida" name="CategoriaId">
							<option value="0" selected>SIN ASIGNAR</option>
							@foreach (var categoria in Model.ComidasCategorias)
							{
								<option value="@categoria.Id">@categoria.Nombre</option>
							}
						</select>
					</div>
					<button type="submit" class="btn btn-primary">Guardar Cambios</button>
				</form>
			</div>
		</div>
	</div>
</div>


<div class="modal fade" id="eliminarComidaModal" tabindex="-1" aria-labelledby="eliminarComidaModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="eliminarComidaModalLabel">Eliminar Comida</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form method="post" asp-page-handler="EliminarComida">
					<input type="hidden" name="Id" id="eliminarComidaId" />
					<p>¿Estás seguro de que deseas eliminar esta comida?</p>
					<button type="submit" class="btn btn-danger">Eliminar</button>
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
				</form>
			</div>
		</div>
	</div>
</div>


@section Scripts {
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

	<script>
		var agregarComidaModal = document.getElementById('agregarComidaModal');
		agregarComidaModal.addEventListener('shown.bs.modal', function () {
			document.getElementById('nombreComida').focus();
		});

		var editarComidaModal = document.getElementById('editarComidaModal');
		editarComidaModal.addEventListener('show.bs.modal', function (event) {
			var button = event.relatedTarget;
			var comidaId = button.getAttribute('data-id');

			fetch(`/Administrador/Menu?handler=ObtenerComida&id=${comidaId}`)
				.then(response => response.json())
				.then(data => {
					document.getElementById('editarComidaId').value = data.id;
					document.getElementById('editarNombreComida').value = data.nombre;
					document.getElementById('editarDescripcionComida').value = data.descripcion;
					document.getElementById('editarPrecioComida').value = data.precio;
					document.getElementById('editarCategoriaComida').value = data.categoriaId;

					setTimeout(() => {
						document.getElementById('editarNombreComida').focus();
					}, 200);
				})
				.catch(error => console.error('Error al cargar los datos de la comida:', error));
		});

		var eliminarComidaModal = document.getElementById('eliminarComidaModal');
		eliminarComidaModal.addEventListener('show.bs.modal', function (event) {
			var button = event.relatedTarget;
			var comidaId = button.getAttribute('data-id');
			document.getElementById('eliminarComidaId').value = comidaId;
		});
	</script>
}